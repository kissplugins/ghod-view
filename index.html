<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GHOD View - GitHub Daily Activity Stream</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    /*
      SAFEGUARD (LLM):
      This file is intentionally a single-page, client-only React app.

      Critical areas that should NOT be refactored casually (even if they look ‚Äúsimplifiable‚Äù):
      - GitHub REST API integration: auth header format, endpoints, pagination, and error handling.
      - Local-day grouping/filtering logic: uses local timezone day keys for UX correctness.
      - PR title fallback + caching: avoids broken/missing titles while limiting API calls.
      - Storage keys (localStorage): used for token + notes persistence; changing keys breaks UX.

      If changes are needed, keep behavior identical and validate manually:
      - Login ‚Üí fetch ‚Üí day filter (Today/Previous Day) ‚Üí PR title rendering ‚Üí assigned issues ‚Üí gist save.
    */
    function GitHubActivityFeed() {
      /*
        SAFEGUARD (LLM): Storage keys and persistence
        - Keys are part of the public UX contract for this app.
        - Do not rename/migrate these without an explicit migration plan.
          - 'gh_token'    : GitHub Personal Access Token (PAT)
          - 'daily_notes' : user notes content
      */
      const [token, setToken] = React.useState(localStorage.getItem('gh_token') || '');
      const [activity, setActivity] = React.useState([]);
      const [assignedIssues, setAssignedIssues] = React.useState([]);
      const [notes, setNotes] = React.useState(localStorage.getItem('daily_notes') || '');
      const [user, setUser] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [tokenInput, setTokenInput] = React.useState('');
      const [copySuccess, setCopySuccess] = React.useState(false);
      const [gistSuccess, setGistSuccess] = React.useState(false);
      const [savingGist, setSavingGist] = React.useState(false);
      const [dayFilter, setDayFilter] = React.useState('today');
      const [showDebug, setShowDebug] = React.useState(false);
      const [showConfig, setShowConfig] = React.useState(false);
      const [enableDebugUI, setEnableDebugUI] = React.useState(true);
      const [enableTypographyInspect, setEnableTypographyInspect] = React.useState(false);
      const [hoveredTypography, setHoveredTypography] = React.useState(null);
      const [debugInfo, setDebugInfo] = React.useState({ fetchError: null, keys: [] });
      const [prCache, setPrCache] = React.useState({});

      React.useEffect(() => {
        /*
          SAFEGUARD (LLM): Typography inspector guardrails
          - Uses requestAnimationFrame throttling to avoid performance issues.
          - Explicitly ignores elements inside [data-debug-ui="true"] to prevent self-inspection loops.
          - Keep the event listener passive and the overlay pointer-events disabled.
        */
        if (!enableTypographyInspect || !enableDebugUI) {
          setHoveredTypography(null);
          return;
        }

        let rafId = 0;
        const handler = (e) => {
          if (rafId) return;
          const { clientX, clientY } = e;
          rafId = window.requestAnimationFrame(() => {
            rafId = 0;
            const el = document.elementFromPoint(clientX, clientY);
            if (!el) return;
            if (el.closest('[data-debug-ui="true"]')) return;

            const cs = window.getComputedStyle(el);
            const tag = el.tagName ? el.tagName.toLowerCase() : '';
            const id = el.id ? `#${el.id}` : '';
            const className = typeof el.className === 'string' && el.className.trim() ? `.${el.className.trim().replace(/\s+/g, '.')}` : '';

            setHoveredTypography({
              tag,
              id,
              className,
              fontFamily: cs.fontFamily,
              fontSize: cs.fontSize,
              fontWeight: cs.fontWeight,
              lineHeight: cs.lineHeight,
              fontStyle: cs.fontStyle,
              letterSpacing: cs.letterSpacing,
            });
          });
        };

        window.addEventListener('pointermove', handler, { passive: true });
        return () => {
          window.removeEventListener('pointermove', handler);
          if (rafId) window.cancelAnimationFrame(rafId);
        };
      }, [enableTypographyInspect, enableDebugUI]);
      
      React.useEffect(() => {
        if (token) {
          fetchActivity();
        }
      }, []);
      
      async function copyToClipboard() {
        try {
          await navigator.clipboard.writeText(notes);
          setCopySuccess(true);
          setTimeout(() => setCopySuccess(false), 2000);
        } catch (err) {
          console.error('Failed to copy:', err);
          alert('Failed to copy to clipboard');
        }
      }
      
      async function saveToGist() {
        /*
          SAFEGUARD (LLM): GitHub Gist integration
          - Endpoint: POST https://api.github.com/gists
          - Requires PAT with 'gist' scope.
          - Payload shape matters (description/public/files).
          - Keep headers and JSON encoding as-is unless you re-test end-to-end.
        */
        if (!notes || !token) return;
        setSavingGist(true);
        setGistSuccess(false);
        
        const today = new Date().toLocaleDateString('en-US', { 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        });
        
        const gistData = {
          description: `GHOD View Notes - ${today}`,
          public: false,
          files: {
            [`ghod-notes-${new Date().toISOString().split('T')[0]}.md`]: {
              content: `# GHOD View Notes - ${today}\n\n${notes}`
            }
          }
        };
        
        try {
          const response = await fetch('https://api.github.com/gists', {
            method: 'POST',
            headers: {
              'Authorization': `token ${token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(gistData)
          });
          
          if (response.ok) {
            const gist = await response.json();
            setGistSuccess(true);
            setTimeout(() => setGistSuccess(false), 3000);
            // Optionally open the gist in a new tab
            window.open(gist.html_url, '_blank');
          } else {
            throw new Error('Failed to create gist');
          }
        } catch (err) {
          console.error('Failed to save to gist:', err);
          alert('Failed to save to GitHub Gist. Make sure your token has "gist" scope.');
        } finally {
          setSavingGist(false);
        }
      }
      
      async function fetchActivity(manualToken) {
        /*
          SAFEGUARD (LLM): Core GitHub integration
          - Auth header must be: Authorization: token <PAT> (current app behavior)
          - Fetch flow order matters:
            1) /user (determine login)
            2) /users/:login/events (paginated; up to maxPages)
            3) /issues?filter=assigned... (sidebar)
          - Pagination is intentionally capped (maxPages) to balance correctness and rate limits.
          - The ‚ÄúPrevious Day‚Äù UX depends on pulling multiple pages and local-day grouping.
        */
        const activeToken = manualToken || token;
        if (!activeToken) return;
        setLoading(true);
        const headers = { 'Authorization': `token ${activeToken}` };
        setDebugInfo((prev) => ({ ...prev, fetchError: null }));
        
        try {
          // Fetch authenticated user
          const userResponse = await fetch('https://api.github.com/user', { headers });
          if (!userResponse.ok) throw new Error(`User fetch failed: ${userResponse.status}`);
          const userData = await userResponse.json();
          setUser(userData);
        
          
          // Fetch user events (pull multiple pages so "Previous Day" isn't pushed out by heavy activity today)
          const perPage = 100;
          const maxPages = 3;
          const localTodayKey = getLocalDayKey(new Date());
          let page = 1;
          let events = [];

          while (page <= maxPages) {
            const response = await fetch(
              `https://api.github.com/users/${userData.login}/events?per_page=${perPage}&page=${page}`,
              { headers }
            );
            if (!response.ok) throw new Error(`Events fetch failed: ${response.status}`);
            const pageEvents = await response.json();
            if (!Array.isArray(pageEvents) || pageEvents.length === 0) break;
            events = events.concat(pageEvents);

            // Stop early once we have at least one prior-day key available
            const groupedPreview = pageEvents.reduce((acc, event) => {
              const day = getLocalDayKey(event.created_at);
              acc[day] = true;
              return acc;
            }, {});
            const previewKeys = Object.keys(groupedPreview);
            const hasPriorDayInThisPage = previewKeys.some((k) => k < localTodayKey);
            if (hasPriorDayInThisPage) break;

            if (pageEvents.length < perPage) break;
            page += 1;
          }
          
          // Group by local day (timezone-aware)
          const grouped = events.reduce((acc, event) => {
            const day = getLocalDayKey(event.created_at);
            if (!acc[day]) acc[day] = [];
            acc[day].push(event);
            return acc;
          }, {});
          const keys = Object.keys(grouped).sort();
          console.log('GHOD day keys (local tz)', keys, `(events=${events.length}, pages=${page})`);
          setDebugInfo((prev) => ({ ...prev, keys }));
          setActivity(grouped);
          
          // Fetch assigned issues
          const issuesResponse = await fetch('https://api.github.com/issues?filter=assigned&state=open&sort=updated&per_page=5', { headers });
          if (!issuesResponse.ok) throw new Error(`Issues fetch failed: ${issuesResponse.status}`);
          const issues = await issuesResponse.json();
          setAssignedIssues(issues);
        } catch (error) {
          console.error('Error fetching data:', error);
          setDebugInfo((prev) => ({ ...prev, fetchError: error?.message || 'Unknown error' }));
          alert('Failed to load GitHub data. Please check your token.');
        } finally {
          setLoading(false);
        }
      }
      
      function handleLogin() {
        if (tokenInput) {
          setToken(tokenInput);
          // SAFEGUARD (LLM): do not rename 'gh_token' without migration.
          localStorage.setItem('gh_token', tokenInput);
          fetchActivity(tokenInput);
        }
      }
      
      function handleLogout() {
        setToken('');
        setUser(null);
        setActivity([]);
        setAssignedIssues([]);
        // SAFEGUARD (LLM): do not rename 'gh_token' without migration.
        localStorage.removeItem('gh_token');
      }
      
      const getEventIcon = (type) => {
        const icons = {
          'PushEvent': { label: '‚ûú', class: 'push' },
          'CreateEvent': { label: '+', class: 'create' },
          'DeleteEvent': { label: '√ó', class: 'delete' },
          'IssuesEvent': { label: '‚óã', class: 'issues' },
          'IssueCommentEvent': { label: '‚óã', class: 'issues' },
          'PullRequestEvent': { label: '‚ûú', class: 'push' },
          'MemberEvent': { label: '‚òÖ', class: 'member' }
        };
        return icons[type] || { label: '‚Ä¢', class: 'push' };
      };

      const getEventDescription = (event) => {
        const time = new Date(event.created_at).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

        const getCommitSummary = (message) => {
          if (!message || typeof message !== 'string') return '';
          const firstLine = message.split(/\r?\n/)[0] || '';
          return firstLine.trim();
        };
        
        if (event.type === 'PushEvent') {
          const commitSummary = getCommitSummary(event.payload?.commits?.[0]?.message);
          const commitCount = Number.isFinite(event.payload?.size) ? event.payload.size : (event.payload?.commits?.length || 0);

          if (commitSummary) {
            const moreCount = Math.max(0, commitCount - 1);
            return moreCount > 0 ? `${commitSummary} (+${moreCount} more)` : commitSummary;
          }

          if (commitCount > 0) {
            return `Pushed ${commitCount} commit${commitCount === 1 ? '' : 's'}`;
          }

          return 'Pushed commits';
        } else if (event.type === 'CreateEvent') {
          return `Created new ${event.payload.ref_type} "${event.payload.ref || ''}"`;
        } else if (event.type === 'DeleteEvent') {
          return `Removed deprecated ${event.payload.ref_type} "${event.payload.ref}"`;
        } else if (event.type === 'IssuesEvent') {
          return `Opened issue: ${event.payload.issue?.title || ''}`;
        } else if (event.type === 'IssueCommentEvent') {
          return `Commented on issue`;
        }
        return '';
      };

      const getBranchData = (event) => {
        const ref = event?.payload?.ref;
        const repo = event?.repo?.name;
        if (!ref || !repo) return null;
        const branch = ref.replace(/^refs\/heads\//, '');
        if (!branch) return null;
        return {
          branch,
          url: `https://github.com/${repo}/tree/${branch}`
        };
      };

      const getPullRequestData = (event) => {
        /*
          SAFEGUARD (LLM): PullRequestEvent parsing + cache contract
          - GitHub event payloads are inconsistent; number/title/url may be missing.
          - cacheKey format MUST remain: "owner/repo#<number>" (used throughout PR cache).
          - Fallback title '#<number>' is required to keep rows readable.
        */
        if (event?.type !== 'PullRequestEvent') return null;

        const repoName = event?.repo?.name;
        const pr = event?.payload?.pull_request;
        const numberValue = pr?.number ?? event?.payload?.number;
        const number = typeof numberValue === 'number' ? numberValue : parseInt(numberValue, 10);
        if (!repoName || !Number.isFinite(number)) return null;

        const cacheKey = `${repoName}#${number}`;
        const cached = prCache[cacheKey];
        const titleFromPayload = pr?.title;
        const titleFromCache = cached?.title;
        const titleFallback = `#${number}`;
        const title = titleFromPayload || titleFromCache || titleFallback;

        const urlFromPayload = pr?.html_url || pr?._links?.html?.href;
        const urlFromCache = cached?.url;
        const url = urlFromPayload || urlFromCache || `https://github.com/${repoName}/pull/${number}`;

        return { cacheKey, repoName, number, title, url, hasRealTitle: Boolean(titleFromPayload || titleFromCache) };
      };

      React.useEffect(() => {
        /*
          SAFEGUARD (LLM): PR title backfill
          - This is a best-effort fallback to populate missing PR titles.
          - Intentionally limits requests (slice(0, 15)) to reduce rate-limit risk.
          - Must be resilient: per-PR failures should not break the feed.
        */
        const activeToken = token || localStorage.getItem('gh_token') || '';
        if (!activeToken) return;

        const events = Object.values(activity || {}).flat();
        const prs = events
          .filter((e) => e?.type === 'PullRequestEvent')
          .map((e) => getPullRequestData(e))
          .filter(Boolean);

        const missing = prs
          .filter((p) => !p.hasRealTitle)
          .filter((p) => !prCache[p.cacheKey]);

        if (missing.length === 0) return;

        let cancelled = false;
        (async () => {
          const headers = { 'Authorization': `token ${activeToken}` };
          for (const prMeta of missing.slice(0, 15)) {
            if (cancelled) return;
            try {
              const response = await fetch(`https://api.github.com/repos/${prMeta.repoName}/pulls/${prMeta.number}`, { headers });
              if (!response.ok) continue;
              const data = await response.json();
              const title = data?.title;
              const url = data?.html_url;
              if (!title && !url) continue;
              setPrCache((prev) => ({
                ...prev,
                [prMeta.cacheKey]: {
                  title: title || prev[prMeta.cacheKey]?.title,
                  url: url || prev[prMeta.cacheKey]?.url
                }
              }));
            } catch (_) {
              // Ignore per-PR fetch errors to avoid breaking the feed
            }
          }
        })();

        return () => {
          cancelled = true;
        };
      }, [activity, token]);

      const getLocalDayKey = (value) => new Date(value).toLocaleDateString('en-CA');

      /*
        SAFEGUARD (LLM): Local-day key logic
        - Uses local timezone keys (YYYY-MM-DD) via 'en-CA' formatting.
        - Do not change to UTC/ISO without re-validating ‚ÄúToday‚Äù and ‚ÄúPrevious Day‚Äù behavior.
      */

      const todayDate = new Date();
      const todayLabel = todayDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
      const todayKey = getLocalDayKey(todayDate);
      const previousDate = new Date(todayDate);
      previousDate.setDate(previousDate.getDate() - 1);
      const previousDayLabel = previousDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
      const previousDayKey = getLocalDayKey(previousDate);
      const selectedDayLabel = dayFilter === 'today' ? todayLabel : previousDayLabel;
      const availableDayKeys = Object.keys(activity || {}).sort().reverse();
      const fallbackPreviousKey = availableDayKeys.find(k => k < todayKey) || null;
      const previousTargetKey = (activity && activity[previousDayKey]) ? previousDayKey : fallbackPreviousKey;
      const filteredActivityEntries = Object.entries(activity).filter(([day]) => {
        if (dayFilter === 'today') return day === todayKey;
        if (dayFilter === 'previous') return previousTargetKey ? day === previousTargetKey : false;
        return true;
      });
      
      // Get unique repos scoped to current filter (fallback to all if none)
      const activeEvents = (filteredActivityEntries.length ? filteredActivityEntries.flatMap(([, evts]) => evts) : Object.values(activity).flat());
      const uniqueRepos = [...new Set(activeEvents.map(e => e.repo.name))].sort();
      
      if (!token) {
        return (
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', minHeight: '100vh', background: '#f6f8fa' }}>
            <div style={{ background: 'white', padding: '40px', borderRadius: '12px', border: '1px solid #d0d7de', maxWidth: '400px', width: '100%' }}>
              <div style={{ textAlign: 'center', marginBottom: '24px' }}>
                <div className="logo" style={{ margin: '0 auto 12px', width: '60px', height: '60px', fontSize: 'var(--fs-lg)' }}>GT</div>
                <h1 style={{ fontSize: 'var(--fs-lg)', marginBottom: '8px' }}>GHOD View</h1>
                <p style={{ color: '#57606a', fontSize: 'var(--fs-sm)' }}>GitHub Daily Activity Stream</p>
              </div>
              <div>
                <label style={{ display: 'block', fontSize: 'var(--fs-sm)', fontWeight: '600', marginBottom: '8px' }}>GitHub Personal Access Token</label>
                <input 
                  type="password" 
                  value={tokenInput}
                  onChange={(e) => setTokenInput(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                  placeholder="ghp_xxxxxxxxxxxx"
                  style={{ width: '100%', padding: '8px 12px', border: '1px solid #d0d7de', borderRadius: '6px', fontSize: 'var(--fs-sm)', marginBottom: '12px' }}
                />
                <button 
                  onClick={handleLogin}
                  style={{ width: '100%', padding: '10px', background: '#0969da', color: 'white', border: 'none', borderRadius: '6px', fontSize: 'var(--fs-sm)', fontWeight: '600', cursor: 'pointer' }}
                >
                  Sign In
                </button>
                <p style={{ fontSize: 'var(--fs-xs)', color: '#57606a', marginTop: '12px', textAlign: 'center' }}>
                  Need a token? <a href="https://github.com/settings/tokens" target="_blank" rel="noopener noreferrer" style={{ color: '#0969da' }}>Generate one here</a><br/>
                  <span style={{ fontSize: 'var(--fs-xs)' }}>Scopes needed: <code>repo</code>, <code>read:user</code>, <code>gist</code></span>
                </p>
              </div>
            </div>
          </div>
        );
      }
      
      return (
        <div>
          <div className="header">
            <div className="header-left">
              <div className="logo">GT</div>
              <div className="header-title">
                <h1>GHOD View</h1>
                <p>GitHub Daily Activity Stream</p>
              </div>
            </div>
            <div className="header-right">
              <span>üë§ {user?.login || 'Loading...'}</span>
              <span>üìÖ {todayLabel}</span>
              <button 
                onClick={handleLogout}
                style={{ padding: '6px 12px', background: '#f6f8fa', border: '1px solid #d0d7de', borderRadius: '6px', fontSize: 'var(--fs-xs)', cursor: 'pointer' }}
              >
                Sign Out
              </button>
            </div>
          </div>
          
          <div className="config-bar">
            <button className="config-toggle" onClick={() => setShowConfig(!showConfig)}>
              {showConfig ? 'Hide Settings' : 'Show Settings'}
            </button>
            {showConfig && (
              <>
                <button 
                  className={`config-toggle ${showDebug ? 'active' : ''}`}
                  onClick={() => setShowDebug(!showDebug)}
                >
                  {showDebug ? 'Hide' : 'Show'} Debug Panel
                </button>
                <button 
                  className={`config-toggle ${enableDebugUI ? 'active' : ''}`}
                  onClick={() => setEnableDebugUI(!enableDebugUI)}
                >
                  {enableDebugUI ? 'Disable' : 'Enable'} Debug UI
                </button>
                <button
                  className={`config-toggle ${enableTypographyInspect ? 'active' : ''}`}
                  onClick={() => setEnableTypographyInspect(!enableTypographyInspect)}
                >
                  {enableTypographyInspect ? 'Disable' : 'Enable'} Typography Inspect
                </button>
              </>
            )}
          </div>

          {enableTypographyInspect && enableDebugUI && hoveredTypography && (
            <div className="font-inspector-overlay" data-debug-ui="true">
              <div className="font-inspector-title">Typography</div>
              <div className="font-inspector-target">{hoveredTypography.tag}{hoveredTypography.id}{hoveredTypography.className}</div>
              <div className="font-inspector-row"><span className="font-inspector-label">Family</span>{hoveredTypography.fontFamily}</div>
              <div className="font-inspector-row"><span className="font-inspector-label">Size</span>{hoveredTypography.fontSize}</div>
              <div className="font-inspector-row"><span className="font-inspector-label">Weight</span>{hoveredTypography.fontWeight}</div>
              <div className="font-inspector-row"><span className="font-inspector-label">Line</span>{hoveredTypography.lineHeight}</div>
              <div className="font-inspector-row"><span className="font-inspector-label">Style</span>{hoveredTypography.fontStyle}</div>
              <div className="font-inspector-row"><span className="font-inspector-label">Letter</span>{hoveredTypography.letterSpacing}</div>
            </div>
          )}

          {uniqueRepos.length > 0 && (
            <div className="repos-bar">
              <strong>Active Repos:</strong>
              <div className="repos-chips">
                {uniqueRepos.map((repo) => (
                  <a
                    key={repo}
                    className="repo-chip"
                    href={`https://github.com/${repo}`}
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {repo}
                  </a>
                ))}
              </div>
            </div>
          )}

          <div className="filter-bar">
            <span className="filter-label">View</span>
            <button 
              className={`filter-button ${dayFilter === 'today' ? 'active' : ''}`}
              onClick={() => setDayFilter('today')}
            >
              Today
            </button>
            <button 
              className={`filter-button ${dayFilter === 'previous' ? 'active' : ''}`}
              onClick={() => setDayFilter('previous')}
            >
              Previous Day
            </button>
            <span className="filter-label">Showing {selectedDayLabel}</span>
            <span className="debug-chip" onClick={() => setShowDebug(!showDebug)} style={{ cursor: 'pointer' }}>
              Debug {showDebug ? '‚ñæ' : '‚ñ∏'}
            </span>
          </div>

          {showDebug && enableDebugUI && (
            <div className="debug-card" data-debug-ui="true">
              <div><strong>Debug:</strong> dayFilter={dayFilter}, todayKey={todayKey}, previousDayKey={previousDayKey}</div>
              <div style={{ marginTop: '4px' }}>Resolved previousTargetKey: {previousTargetKey || 'none'}</div>
              <div style={{ marginTop: '6px' }}>Available days (newest first):</div>
              <div className="debug-pre">{availableDayKeys.join('\n') || 'none'}</div>
              {enableTypographyInspect && (
                <>
                  <div style={{ marginTop: '10px' }}><strong>Typography Inspect:</strong> hover elements to see computed font metrics.</div>
                  <div className="debug-pre">
                    {hoveredTypography
                      ? [
                          `target: ${hoveredTypography.tag}${hoveredTypography.id}${hoveredTypography.className}`,
                          `font-family: ${hoveredTypography.fontFamily}`,
                          `font-size: ${hoveredTypography.fontSize}`,
                          `font-weight: ${hoveredTypography.fontWeight}`,
                          `line-height: ${hoveredTypography.lineHeight}`,
                          `font-style: ${hoveredTypography.fontStyle}`,
                          `letter-spacing: ${hoveredTypography.letterSpacing}`
                        ].join('\n')
                      : 'Hover an element‚Ä¶'}
                  </div>
                </>
              )}
              {debugInfo.fetchError && (
                <div style={{ marginTop: '6px', color: '#cf222e' }}>Fetch error: {debugInfo.fetchError}</div>
              )}
              {debugInfo.keys?.length > 0 && (
                <div style={{ marginTop: '6px' }}>Console keys: {debugInfo.keys.join(', ')}</div>
              )}
            </div>
          )}

          <div className="container">
            <div className="main-content">
              {filteredActivityEntries.length === 0 ? (
                <div className="card">
                  <div className="card-body">
                    <div style={{ color: '#57606a', fontSize: 'var(--fs-sm)' }}>
                      {loading ? 'Loading activity...' : `No activity for ${selectedDayLabel}.`}
                    </div>
                  </div>
                </div>
              ) : (
                filteredActivityEntries.map(([day, events]) => {
                  const date = new Date(day + 'T00:00:00');
                  const formatted = date.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                  });
                  
                  return (
                    <div key={day} className="day-section">
                      <div className="day-header">{formatted}</div>
                      {events.map(e => {
                        const icon = getEventIcon(e.type);
                        const desc = getEventDescription(e);
                        const time = new Date(e.created_at).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                        const branchInfo = getBranchData(e);
                        const isBranchEvent = branchInfo && (
                          e.type === 'PushEvent' ||
                          (e.type === 'CreateEvent' && e.payload?.ref_type === 'branch') ||
                          (e.type === 'DeleteEvent' && e.payload?.ref_type === 'branch')
                        );
                        const prInfo = getPullRequestData(e);
                        
                        return (
                          <div key={e.id} className="activity-item">
                            <div className={`activity-icon ${icon.class}`}>{icon.label}</div>
                            <div className="activity-content">
                              <div className="activity-type">{e.type.replace('Event', '')}</div>
                              <div className="activity-repo">
                                <a href={`https://github.com/${e.repo.name}`} target="_blank" rel="noopener noreferrer">
                                  {e.repo.name}
                                </a>
                              </div>
                              {isBranchEvent && branchInfo && (
                                <div className="activity-branch">
                                  Branch: <a href={branchInfo.url} target="_blank" rel="noopener noreferrer">{branchInfo.branch}</a>
                                </div>
                              )}
                              {prInfo && (
                                <div className="activity-pr">
                                  PR: <a href={prInfo.url} target="_blank" rel="noopener noreferrer">{prInfo.title}</a>
                                </div>
                              )}
                              {desc && <div className="activity-desc">{desc}</div>}
                              <div className="activity-time">{time}</div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  );
                })
              )}
            </div>
            
            <div className="sidebar">
              <div className="card">
                <div className="card-header">
                  üìù My Notes for Today
                </div>
                <div className="card-body">
                  <textarea 
                    className="notes-textarea"
                    value={notes}
                    onChange={(e) => {
                      setNotes(e.target.value);
                      localStorage.setItem('daily_notes', e.target.value);
                    }}
                    placeholder="Add your notes for today..."
                  />
                  <button 
                    className={`copy-btn ${copySuccess ? 'success' : ''}`}
                    onClick={copyToClipboard}
                    disabled={!notes}
                  >
                    {copySuccess ? '‚úì Copied!' : 'üìã Copy to Clipboard'}
                  </button>
                  <button 
                    className={`gist-btn ${gistSuccess ? 'success' : ''}`}
                    onClick={saveToGist}
                    disabled={!notes || savingGist}
                  >
                    {savingGist ? 'üíæ Saving...' : gistSuccess ? '‚úì Saved to Gist!' : 'üíæ Save to GitHub Gist'}
                  </button>
                  <div className="notes-hint">These notes will only appear on this computer</div>
                </div>
              </div>

              <div className="card">
                <div className="card-header">
                  ‚è∞ Assigned Issues
                </div>
                <div className="card-body">
                  {assignedIssues.map(issue => {
                    const repoName = issue.repository_url.split('/').slice(-2).join('/');
                    const repoUrl = `https://github.com/${repoName}`;
                    
                    return (
                      <div key={issue.id} className="issue-item">
                        <div className="issue-title">
                          <a href={issue.html_url} target="_blank" rel="noopener noreferrer">
                            {issue.title}
                          </a>
                        </div>
                        <div className="issue-meta">
                          <a className="issue-repo-chip" href={repoUrl} target="_blank" rel="noopener noreferrer">{repoName}</a>
                          <span>‚Ä¢</span>
                          <span className="issue-number">#{issue.number}</span>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          </div>
          <div className="footer">
            GHOD View ¬© Copyright 2026 Hypercart | <a href="mailto:info@hypercart.io">info@hypercart.io</a> | <a href="https://github.com/kissplugins/ghod-view/blob/main/LICENSE" target="_blank" rel="noopener noreferrer">FSL 5 License</a>
          </div>
        </div>
      );
    }
    
    ReactDOM.render(<GitHubActivityFeed />, document.getElementById('root'));
  </script>
</body>
</html>